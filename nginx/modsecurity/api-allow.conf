# Autorise les méthodes PUT/PATCH/DELETE sur /api seulement
SecAction "id:100100,phase:1,pass,nolog,t:none, \
  setvar:tx.allowed_methods=|GET|HEAD|POST|OPTIONS|PUT|PATCH|DELETE|"

# Protection : accepte uniquement application/json (avec ou sans charset) sur PUT/PATCH/POST
SecRule REQUEST_METHOD "@within PUT|PATCH|POST" \
  "id:100101,phase:1,deny,status:415,log,msg:'Invalid Content-Type',chain"
  SecRule REQUEST_HEADERS:Content-Type "!@rx ^application/json(;.*)?$"

# Autoriser explicitement les locales JSON
SecRule REQUEST_URI "@beginsWith /locales/" "id:100500,phase:1,pass,ctl:ruleEngine=DetectionOnly,nolog,allow"

# Limiter taille des requêtes (10 Mo max, 128k sans fichiers)
SecAction "id:100102,phase:1,pass,nolog,t:none, \
  setvar:'tx.request_body_limit=10485760', \
  setvar:'tx.request_body_no_files_limit=131072'"
